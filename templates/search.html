{% extends 'base.html' %}

{% block title %}Nutrition: Search{% endblock %}

<!-- ************************************************************* -->

{% block content %}

<h3>Food Diary</h3>

    <form id='food-request' action="/search" method='POST'>
        <label name='food-input'> 
            <input id="food-input" name="food-input" required>
        </label><br>
        <input type="submit" value="Search!">
    </form>
    <br><br>
    <form id='all-foods-eaten' action="/" method='POST'>
        <div class="food-list">
        <!-- {% if food_info %}
            {{ food_info }}
        {% endif %} -->
        </div>
        <br>
        <input type="submit" value = "Confirm inputs" id="send-input">
    </form>

{% endblock %}
<!-- ************************************************************* -->

{% block JQ %}
    <script>
    $( function() {
    let availableFoods = {{ searchlist| tojson }};
    $( "#food-input" ).autocomplete({
        minLength: 3,
        source: availableFoods
        });
    });

    function showResult(result) {
        let name = result[0].replace(" ", "").replace(",", "")
        // let name = 'kale'
        let buttonName = 'deleteButton' + name;
        $(".food-list").append("<div id='" + name + "'>")
        console.log('#' + result[0])

        $('#' + name).append("<b>" + result[0] + "<b> <button type=button id=" + buttonName + ">X</button>").append("<br>") 
        $('#' + name).append("<i>Serving size: </i> " +  result[1] + " " + result[2])
        $('#' + name).append("<form id='serving-size'><input type='number' id='serving-amt' placeholder='Enter amt' required> serving(s)</form>")
        $('#' + name).append("<br>")
        $('#' + name).append("</div>")

        $("#" + buttonName).on("click", function(evt) {
            evt.preventDefault;
            $('#' + name).remove();
            // console.log(name);
        });
    }


    function askForFoods(evt) {
        evt.preventDefault();

        let input = {
            "input": $('#food-input').val()
        };
        console.log(input)

        $.post("/search", 
               input, 
               showResult);

    }


    $("#food-request").on("submit", askForFoods);

    $("#food-request").on("submit", function(){
        $("#food-input").val('');
    });

    // $('#show-foods').attr("style", "color:#0000FF")
    </script>
{% endblock %}

